<!-- iframe1.html -->
<html>
<head>
    <style>
        body {
            background:red;
        }
        #myDIV{
            background:yellow;
            border:3px solid brown;
            padding:50px;
            margin:10px 0;
        }
		 button {
			padding: 10px 20px;
			border: none;
			border-radius: 6px;
			background-color: #007bff;
			color: white;
			cursor: pointer;
			font-size: 16px;
		}
		button:hover {
			background-color: #0056b3;
		}
    </style>

<!--
<script type="text/javascript" src="https://sb2wsdk-altenar2-stage.biahosted.com/altenarWSDK.js" data-nscript="afterInteractive"></script>
-->

</head>
<body>

<h1>Iframe random content with just an Event button</h1>

<p>Click on the following "EventId" btn and update via postMessage the sb content! </p>
<p>and log the postMessage in console</p>

<div id="container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('container');

      const button = document.createElement('button');
      button.textContent = 'EventId=10571659';
      button.addEventListener('click', () => {
        window.top.postMessage({
         type: 'wsdk-sb-set',
            data: {
              eventId: 10571659,
          }
        }, '*');
      });

      container.appendChild(button);
    });
	
	// up to this point was working and just logging when iframe's postMessage to sb was fired
	
	const container = document.querySelector('#content');

    // Set up a ResizeObserver to notify the parent when the height changes
    const observer = new ResizeObserver(entries => {
      for (let entry of entries) {
        const { height } = entry.contentRect;
        window.top.postMessage({ type: 'wsdk-update-height', data: { height } }, '*');
      }
    });

    observer.observe(container);

    // Listen for messages from the parent
    window.addEventListener('message', (event) => {
      const { type, data } = event.data;

      if (type === 'wsdk-data') {
        // Handle initialization data
        const { eventId } = data;
        console.log('Received initialization data:', { eventId });

        // Initialize your custom widget with the received data
        // ...

        // Example: Add a button that sends data to the parent to redirect within sb
        const button = document.createElement('button');
        button.textContent = 'To event';
        button.addEventListener('click', () => {
          window.top.postMessage({
            type: 'wsdk-sb-set',
            data: {
              eventId: 12345666,
            }
          }, '*');
        });

        container.appendChild(button);
      }
    });

    // Request initialization data from the parent
    window.top.postMessage({ type: 'wsdk-get-data' }, '*');
	console.log('Handling wsdk-get-data:', event.data.wsdk-get-data);
	
	  // Optional: check origin for security
    // if (event.origin !== "https://your-allowed-origin.com") return;

    const message = event.data;

    if (!message || !message.type) {
        console.log("Received message with no type:", message);
        return;
    }

    switch(message.type) {
        case "wsdk-data":
            console.log("wsdk-data message:", message);
            break;
        case "wsdk-get-data":
            console.log("wsdk-get-data message:", message);
            break;
        case "wsdk-update-height":
            console.log("Type 3 message:", message);
            break;
        case "wsdk-sb-set":
            console.log("Type 4 message:", message);
            break;
        default:
            console.log("Unknown message type:", message);
    }
});
  </script>

		
</body>
</html>
